<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>系统管理 - 智能体监控与配置</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
        }
        .hero-title {
            font-family: 'Noto Serif SC', serif;
            background: linear-gradient(135deg, #06b6d4, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .agent-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .dashboard-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .metric-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        .floating-animation {
            animation: float 6s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        .glow-effect {
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.3);
        }
        .progress-bar {
            background: linear-gradient(90deg, #06b6d4, #3b82f6);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-online { background-color: #10b981; }
        .status-processing { background-color: #f59e0b; animation: pulse 2s infinite; }
        .status-offline { background-color: #ef4444; }
        .status-idle { background-color: #6b7280; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .log-entry {
            border-left: 3px solid;
            padding-left: 12px;
            margin-bottom: 8px;
        }
        .log-info { border-color: #3b82f6; }
        .log-warning { border-color: #f59e0b; }
        .log-error { border-color: #ef4444; }
        .log-success { border-color: #10b981; }
        
        /* 系统初始化时间样式 */
        .system-init-time {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.2), rgba(59, 130, 246, 0.2));
            border: 1px solid rgba(6, 182, 212, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            text-align: center;
        }
        .system-init-time .label {
            font-size: 12px;
            color: #94a3b8;
            margin-bottom: 4px;
        }
        .system-init-time .time {
            font-size: 16px;
            font-weight: bold;
            color: #06b6d4;
        }
        #particles-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }
    </style>
</head>
<body class="text-white overflow-x-hidden">
    <!-- 粒子背景容器 -->
    <div id="particles-container"></div>
    
    <!-- 导航栏 -->
    <nav class="fixed top-0 left-0 right-0 z-50 bg-slate-900/80 backdrop-blur-md border-b border-slate-700/50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-gradient-to-br from-cyan-400 to-blue-600 rounded-lg flex items-center justify-center">
                        <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <span class="text-xl font-bold">灵图智谱</span>
                </div>
                <div class="flex items-center space-x-6">
                    <a href="index.html" class="text-slate-300 hover:text-white transition-colors">首页</a>
                    <a href="query.html" class="text-slate-300 hover:text-white transition-colors">知识查询</a>
                    <a href="graph.html" class="text-slate-300 hover:text-white transition-colors">图谱可视</a>
                    <a href="admin.html" class="text-cyan-400 hover:text-cyan-300 transition-colors font-medium">系统管理</a>
                    <a href="user-center.html" class="text-slate-300 hover:text-white transition-colors">用户中心</a>
                    <button onclick="logout()" class="text-slate-300 hover:text-red-400 transition-colors">退出登录</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 主要内容区域 -->
    <main class="pt-24 pb-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Hero 区域 -->
            <div class="text-center mb-16 floating-animation">
                <h1 class="text-5xl md:text-6xl font-bold hero-title mb-6">系统管理控制台</h1>
                <p class="text-xl text-slate-400 max-w-3xl mx-auto">智能体性能监控、系统配置管理和运行状态实时查看</p>
            </div>

            <!-- 系统概览仪表板 -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                <div class="metric-card rounded-2xl p-6 glow-effect">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-slate-400 text-sm">系统状态</p>
                            <p class="text-2xl font-bold text-green-400">正常运行</p>
                        </div>
                        <div class="w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center">
                            <svg class="w-6 h-6 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="metric-card rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-slate-400 text-sm">活跃智能体</p>
                            <p class="text-2xl font-bold text-cyan-400">4/4</p>
                        </div>
                        <div class="w-12 h-12 bg-cyan-500/20 rounded-lg flex items-center justify-center">
                            <svg class="w-6 h-6 text-cyan-400" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="metric-card rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-slate-400 text-sm">平均响应时间</p>
                            <p class="text-2xl font-bold text-yellow-400">1.2s</p>
                        </div>
                        <div class="w-12 h-12 bg-yellow-500/20 rounded-lg flex items-center justify-center">
                            <svg class="w-6 h-6 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="metric-card rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-slate-400 text-sm">今日处理量</p>
                            <p class="text-2xl font-bold text-purple-400">1,247</p>
                        </div>
                        <div class="w-12 h-12 bg-purple-500/20 rounded-lg flex items-center justify-center">
                            <svg class="w-6 h-6 text-purple-400" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-stretch">
                <!-- 系统资源监控 - 占据所有列 -->
                <div class="lg:col-span-3 dashboard-card rounded-xl p-6 mb-8">
                    <h3 class="text-lg font-semibold mb-4">系统资源</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- CPU使用率 -->
                        <div class="flex flex-col items-center" id="cpu-resource">
                            <div class="flex items-center justify-between w-full mb-2">
                                <p class="text-sm text-slate-400">CPU使用率</p>
                                <div class="w-10 h-10 bg-cyan-500/20 rounded-lg flex items-center justify-center">
                                    <svg class="w-5 h-5 text-cyan-400" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z"/>
                                    </svg>
                                </div>
                            </div>
                            <p class="text-2xl font-bold text-cyan-400 mb-2" id="cpu-percent">45%</p>
                            <div class="w-full bg-slate-700 rounded-full h-2">
                                <div class="bg-gradient-to-r from-cyan-500 to-blue-600 h-2 rounded-full" id="cpu-bar" style="width: 45%"></div>
                            </div>
                        </div>
                        
                        <!-- 内存使用率 -->
                        <div class="flex flex-col items-center" id="memory-resource">
                            <div class="flex items-center justify-between w-full mb-2">
                                <p class="text-sm text-slate-400">内存使用率</p>
                                <div class="w-10 h-10 bg-green-500/20 rounded-lg flex items-center justify-center">
                                    <svg class="w-5 h-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm3 2a1 1 0 011-1h6a1 1 0 011 1v1a1 1 0 11-2 0V7H7v1a1 1 0 01-2 0V7zM3 10a1 1 0 011-1h12a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zm3 2a1 1 0 011-1h6a1 1 0 011 1v3a1 1 0 11-2 0v-3H7v3a1 1 0 01-2 0v-3z" clip-rule="evenodd"/>
                                    </svg>
                                </div>
                            </div>
                            <p class="text-2xl font-bold text-green-400 mb-2" id="memory-percent">68%</p>
                            <div class="w-full bg-slate-700 rounded-full h-2">
                                <div class="bg-gradient-to-r from-green-500 to-emerald-600 h-2 rounded-full" id="memory-bar" style="width: 68%"></div>
                            </div>
                        </div>
                        
                        <!-- 磁盘使用率 -->
                        <div class="flex flex-col items-center" id="disk-resource">
                            <div class="flex items-center justify-between w-full mb-2">
                                <p class="text-sm text-slate-400">磁盘使用率</p>
                                <div class="w-10 h-10 bg-purple-500/20 rounded-lg flex items-center justify-center">
                                    <svg class="w-5 h-5 text-purple-400" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M5 4a1 1 0 011 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2V8a2 2 0 00-2-2h-1V5a1 1 0 112 0v1h1a1 1 0 110 2H4a1 1 0 010-2h1V5a1 1 0 011-1zm0 5a1 1 0 011 1v3a1 1 0 11-2 0v-3a1 1 0 011-1zm8 0a1 1 0 011 1v3a1 1 0 11-2 0v-3a1 1 0 011-1z" clip-rule="evenodd"/>
                                    </svg>
                                </div>
                            </div>
                            <p class="text-2xl font-bold text-purple-400 mb-2" id="disk-percent">32%</p>
                            <div class="w-full bg-slate-700 rounded-full h-2">
                                <div class="bg-gradient-to-r from-purple-500 to-pink-600 h-2 rounded-full" id="disk-bar" style="width: 32%"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 智能体监控 - 占据2列 -->
                <div class="lg:col-span-2">
                    <div class="dashboard-card rounded-xl p-6 mb-8">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-2xl font-bold">智能体监控</h2>
                            <div class="flex items-center space-x-2">
                                <span class="status-indicator status-online"></span>
                                <span class="text-sm text-slate-400">实时更新</span>
                            </div>
                        </div>

                        <!-- 智能体状态网格 -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                            <!-- 构建者智能体 -->
                            <div class="dashboard-card rounded-lg p-4 h-full flex flex-col">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center space-x-3">
                                        <img src="resources/agent-icons/builder.png" alt="构建者智能体" class="w-8 h-8">
                                        <div>
                                            <h3 class="font-semibold">构建者智能体</h3>
                                            <p class="text-sm text-slate-400">文档处理</p>
                                        </div>
                                    </div>
                                    <span class="status-indicator status-processing"></span>
                                </div>
                                <div class="space-y-2 text-sm flex-grow">
                                    <div class="flex justify-between">
                                        <span class="text-slate-400">状态:</span>
                                        <span class="text-yellow-400">处理中</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-slate-400">队列:</span>
                                        <span>15/20 文档</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-slate-400">效率:</span>
                                        <span class="text-green-400">94%</span>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <div class="w-full bg-slate-600 rounded-full h-2">
                                        <div class="bg-gradient-to-r from-blue-500 to-cyan-500 h-2 rounded-full transition-all duration-300" style="width: 75%"></div>
                                    </div>
                                    <div class="text-xs text-slate-400 mt-1">处理进度: 75%</div>
                                </div>
                            </div>

                            <!-- 审计智能体 -->
                            <div class="dashboard-card rounded-lg p-4 h-full flex flex-col">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center space-x-3">
                                        <img src="resources/agent-icons/auditor.png" alt="审计智能体" class="w-8 h-8">
                                        <div>
                                            <h3 class="font-semibold">审计智能体</h3>
                                            <p class="text-sm text-slate-400">质量检查</p>
                                        </div>
                                    </div>
                                    <span class="status-indicator status-online"></span>
                                </div>
                                <div class="space-y-2 text-sm flex-grow">
                                    <div class="flex justify-between">
                                        <span class="text-slate-400">状态:</span>
                                        <span class="text-green-400">运行中</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-slate-400">质量评分:</span>
                                        <span class="text-green-400">96.2%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-slate-400">检查项:</span>
                                        <span>1,247 项</span>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <div class="w-full bg-slate-600 rounded-full h-2">
                                        <div class="bg-gradient-to-r from-green-500 to-emerald-500 h-2 rounded-full transition-all duration-300" style="width: 90%"></div>
                                    </div>
                                    <div class="text-xs text-slate-400 mt-1">检查进度: 90%</div>
                                </div>
                            </div>

                            <!-- 分析师智能体 -->
                            <div class="dashboard-card rounded-lg p-4 h-full flex flex-col">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center space-x-3">
                                        <img src="resources/agent-icons/analyst.png" alt="分析师智能体" class="w-8 h-8">
                                        <div>
                                            <h3 class="font-semibold">分析师智能体</h3>
                                            <p class="text-sm text-slate-400">查询处理</p>
                                        </div>
                                    </div>
                                    <span class="status-indicator status-idle"></span>
                                </div>
                                <div class="space-y-2 text-sm flex-grow">
                                    <div class="flex justify-between">
                                        <span class="text-slate-400">状态:</span>
                                        <span class="text-slate-400">空闲</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-slate-400">响应时间:</span>
                                        <span class="text-cyan-400">1.2s</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-slate-400">准确率:</span>
                                        <span class="text-green-400">91.5%</span>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <div class="w-full bg-slate-600 rounded-full h-2">
                                        <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full transition-all duration-300" style="width: 25%"></div>
                                    </div>
                                    <div class="text-xs text-slate-400 mt-1">负载: 25%</div>
                                </div>
                            </div>

                            <!-- 扩展智能体 -->
                            <div class="dashboard-card rounded-lg p-4 h-full flex flex-col">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center space-x-3">
                                        <img src="resources/agent-icons/extension.png" alt="扩展智能体" class="w-8 h-8">
                                        <div>
                                            <h3 class="font-semibold">扩展智能体</h3>
                                            <p class="text-sm text-slate-400">插件管理</p>
                                        </div>
                                    </div>
                                    <span class="status-indicator status-processing"></span>
                                </div>
                                <div class="space-y-2 text-sm flex-grow">
                                    <div class="flex justify-between">
                                        <span class="text-slate-400">状态:</span>
                                        <span class="text-yellow-400">加载中</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-slate-400">已加载:</span>
                                        <span>12/20 插件</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-slate-400">API调用:</span>
                                        <span class="text-cyan-400">847 次</span>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <div class="w-full bg-slate-600 rounded-full h-2">
                                        <div class="bg-gradient-to-r from-orange-500 to-red-500 h-2 rounded-full transition-all duration-300" style="width: 60%"></div>
                                    </div>
                                    <div class="text-xs text-slate-400 mt-1">加载进度: 60%</div>
                                </div>
                            </div>
                        </div>

                        <!-- 性能图表 -->
                        <div>
                            <h3 class="text-lg font-semibold mb-4">性能监控</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="flex flex-col">
                                    <h4 class="text-sm font-medium mb-3 text-slate-400">响应时间趋势</h4>
                                    <div id="response-time-chart" style="height: 250px; flex-grow: 1;"></div>
                                </div>
                                <div class="flex flex-col">
                                    <h4 class="text-sm font-medium mb-3 text-slate-400">处理量统计</h4>
                                    <div id="throughput-chart" style="height: 250px; flex-grow: 1;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    

                </div>

                <!-- 侧边栏 - 占据1列 -->
                <div class="lg:col-span-1 space-y-6">
    


                    <!-- 系统配置 -->
                    <div class="dashboard-card rounded-xl p-6">
                        <h3 class="text-lg font-semibold mb-4">系统配置</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">最大并发数</label>
                                <input type="number" value="100" class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:outline-none focus:border-cyan-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">超时时间 (秒)</label>
                                <input type="number" value="30" class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:outline-none focus:border-cyan-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">缓存大小 (MB)</label>
                                <input type="number" value="512" class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:outline-none focus:border-cyan-500">
                            </div>
                            <button onclick="saveConfig()" class="w-full px-4 py-2 bg-cyan-600 hover:bg-cyan-700 rounded-lg transition-colors">
                                保存配置
                            </button>
                        </div>
                    </div>

                    <!-- 系统日志 -->
                    <div class="dashboard-card rounded-xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold">系统日志</h3>
                            <button onclick="refreshLogs()" class="text-cyan-400 hover:text-cyan-300 transition-colors">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
                                </svg>
                            </button>
                        </div>
                        <div id="system-logs" class="space-y-2 max-h-80 overflow-y-auto">
                            <!-- 日志内容将在这里动态生成 -->
                        </div>
                    </div>
                </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="py-12 border-t border-slate-700/50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-slate-400">© 2025 灵图智谱. 基于多智能体协作的先进知识工程平台.</p>
        </div>
    </footer>

    <script>
        // 生成当前时间格式的函数
        function getCurrentTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        }
        
        // 生成基于当前时间的系统日志
        function generateSystemLogs() {
            const currentTime = new Date();
            const logs = [];
            
            // 系统启动完成日志（当前时间）
            logs.push({
                timestamp: getCurrentTime(),
                level: 'info',
                message: '系统启动完成，所有智能体准备就绪'
            });
            
            // 知识图谱更新完成（当前时间 - 15秒）
            const kgUpdateTime = new Date(currentTime.getTime() - 15000);
            logs.push({
                timestamp: `${kgUpdateTime.getFullYear()}-${String(kgUpdateTime.getMonth() + 1).padStart(2, '0')}-${String(kgUpdateTime.getDate()).padStart(2, '0')} ${String(kgUpdateTime.getHours()).padStart(2, '0')}:${String(kgUpdateTime.getMinutes()).padStart(2, '0')}:${String(kgUpdateTime.getSeconds()).padStart(2, '0')}`,
                level: 'success',
                message: '知识图谱更新完成，新增156个节点'
            });
            
            // 内存使用率警告（当前时间 - 30秒）
            const memoryWarnTime = new Date(currentTime.getTime() - 30000);
            logs.push({
                timestamp: `${memoryWarnTime.getFullYear()}-${String(memoryWarnTime.getMonth() + 1).padStart(2, '0')}-${String(memoryWarnTime.getDate()).padStart(2, '0')} ${String(memoryWarnTime.getHours()).padStart(2, '0')}:${String(memoryWarnTime.getMinutes()).padStart(2, '0')}:${String(memoryWarnTime.getSeconds()).padStart(2, '0')}`,
                level: 'warning',
                message: '内存使用率超过80%，建议优化配置'
            });
            
            // 数据库连接超时（当前时间 - 60秒）
            const dbTimeoutTime = new Date(currentTime.getTime() - 60000);
            logs.push({
                timestamp: `${dbTimeoutTime.getFullYear()}-${String(dbTimeoutTime.getMonth() + 1).padStart(2, '0')}-${String(dbTimeoutTime.getDate()).padStart(2, '0')} ${String(dbTimeoutTime.getHours()).padStart(2, '0')}:${String(dbTimeoutTime.getMinutes()).padStart(2, '0')}:${String(dbTimeoutTime.getSeconds()).padStart(2, '0')}`,
                level: 'error',
                message: '数据库连接超时，正在重试连接...'
            });
            
            // 分析师智能体处理查询（当前时间 - 90秒）
            const analystTime = new Date(currentTime.getTime() - 90000);
            logs.push({
                timestamp: `${analystTime.getFullYear()}-${String(analystTime.getMonth() + 1).padStart(2, '0')}-${String(analystTime.getDate()).padStart(2, '0')} ${String(analystTime.getHours()).padStart(2, '0')}:${String(analystTime.getMinutes()).padStart(2, '0')}:${String(analystTime.getSeconds()).padStart(2, '0')}`,
                level: 'info',
                message: '分析师智能体处理查询: "苹果公司创新策略分析"'
            });
            
            // 扩展智能体插件加载缓慢（当前时间 - 105秒）
            const extensionTime = new Date(currentTime.getTime() - 105000);
            logs.push({
                timestamp: `${extensionTime.getFullYear()}-${String(extensionTime.getMonth() + 1).padStart(2, '0')}-${String(extensionTime.getDate()).padStart(2, '0')} ${String(extensionTime.getHours()).padStart(2, '0')}:${String(extensionTime.getMinutes()).padStart(2, '0')}:${String(extensionTime.getSeconds()).padStart(2, '0')}`,
                level: 'warning',
                message: '扩展智能体插件加载缓慢，预计延迟2分钟'
            });
            
            // 审计智能体完成质量检查（当前时间 - 120秒）
            const auditorTime = new Date(currentTime.getTime() - 120000);
            logs.push({
                timestamp: `${auditorTime.getFullYear()}-${String(auditorTime.getMonth() + 1).padStart(2, '0')}-${String(auditorTime.getDate()).padStart(2, '0')} ${String(auditorTime.getHours()).padStart(2, '0')}:${String(auditorTime.getMinutes()).padStart(2, '0')}:${String(auditorTime.getSeconds()).padStart(2, '0')}`,
                level: 'success',
                message: '审计智能体完成质量检查，评分: 96.2%'
            });
            
            // 构建者智能体开始处理文档（当前时间 - 135秒）
            const builderTime = new Date(currentTime.getTime() - 135000);
            logs.push({
                timestamp: `${builderTime.getFullYear()}-${String(builderTime.getMonth() + 1).padStart(2, '0')}-${String(builderTime.getDate()).padStart(2, '0')} ${String(builderTime.getHours()).padStart(2, '0')}:${String(builderTime.getMinutes()).padStart(2, '0')}:${String(builderTime.getSeconds()).padStart(2, '0')}`,
                level: 'info',
                message: '构建者智能体开始处理文档批次 #1247'
            });
            
            return logs;
        }
        
        // 初始化系统日志
        const systemLogs = generateSystemLogs();

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            initCharts();
            initSystemLogs();
            initAnimations();
            startRealTimeUpdates();
            loadConfig();
        });
        
        // 加载配置
        async function loadConfig() {
            try {
                // 检查令牌是否存在
                const token = localStorage.getItem('access_token');
                if (!token) {
                    console.warn('未登录，无法加载配置');
                    return;
                }
                
                // 发送API请求获取配置
                const response = await fetch('http://localhost:8000/api/config', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                // 获取响应数据
                const responseData = await response.json();
                
                if (!response.ok) {
                    throw new Error(responseData.detail || '获取配置失败');
                }
                
                // 填充表单值
                const inputs = document.querySelectorAll('.dashboard-card input[type="number"]');
                if (inputs.length === 3) {
                    inputs[0].value = responseData.max_concurrent;
                    inputs[1].value = responseData.timeout_seconds;
                    inputs[2].value = responseData.cache_size_mb;
                    
                    console.log('配置加载成功:', responseData);
                } else {
                    throw new Error('无法找到配置输入字段');
                }
            } catch (error) {
                console.error('加载配置失败:', error);
                
                // 显示错误通知
                const notification = document.createElement('div');
                notification.className = 'fixed top-20 right-6 bg-yellow-600 text-white px-6 py-3 rounded-lg shadow-lg z-50';
                notification.textContent = `加载配置失败: ${error.message}`;
                document.body.appendChild(notification);

                // 添加动画
                anime({
                    targets: notification,
                    translateX: [300, 0],
                    opacity: [0, 1],
                    duration: 300,
                    easing: 'easeOutQuart'
                });

                // 3秒后移除通知
                setTimeout(() => {
                    anime({
                        targets: notification,
                        translateX: [0, 300],
                        opacity: [1, 0],
                        duration: 300,
                        easing: 'easeInQuart',
                        complete: () => {
                            document.body.removeChild(notification);
                        }
                    });
                }, 3000);
            }
        }

        // 初始化图表
        function initCharts() {
            // 响应时间趋势图
            const responseTimeChart = echarts.init(document.getElementById('response-time-chart'));
            const responseTimeOption = {
                backgroundColor: 'transparent',
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'],
                    axisLine: { lineStyle: { color: '#64748b' } },
                    axisLabel: { color: '#94a3b8', fontSize: 10 }
                },
                yAxis: {
                    type: 'value',
                    axisLine: { lineStyle: { color: '#64748b' } },
                    axisLabel: { color: '#94a3b8', fontSize: 10 },
                    splitLine: { lineStyle: { color: '#334155' } }
                },
                series: [{
                    data: [1.2, 0.8, 1.5, 2.1, 1.8, 1.2],
                    type: 'line',
                    smooth: true,
                    lineStyle: { color: '#06b6d4', width: 2 },
                    itemStyle: { color: '#06b6d4' },
                    areaStyle: {
                        color: {
                            type: 'linear',
                            x: 0, y: 0, x2: 0, y2: 1,
                            colorStops: [
                                { offset: 0, color: 'rgba(6, 182, 212, 0.3)' },
                                { offset: 1, color: 'rgba(6, 182, 212, 0.05)' }
                            ]
                        }
                    }
                }]
            };
            responseTimeChart.setOption(responseTimeOption);

            // 处理量统计图
            const throughputChart = echarts.init(document.getElementById('throughput-chart'));
            const throughputOption = {
                backgroundColor: 'transparent',
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: ['构建者', '审计者', '分析师', '扩展者'],
                    axisLine: { lineStyle: { color: '#64748b' } },
                    axisLabel: { color: '#94a3b8', fontSize: 10 }
                },
                yAxis: {
                    type: 'value',
                    axisLine: { lineStyle: { color: '#64748b' } },
                    axisLabel: { color: '#94a3b8', fontSize: 10 },
                    splitLine: { lineStyle: { color: '#334155' } }
                },
                series: [{
                    data: [156, 203, 89, 134],
                    type: 'bar',
                    itemStyle: {
                        color: {
                            type: 'linear',
                            x: 0, y: 0, x2: 0, y2: 1,
                            colorStops: [
                                { offset: 0, color: '#8b5cf6' },
                                { offset: 1, color: '#06b6d4' }
                            ]
                        }
                    },
                    barWidth: '60%'
                }]
            };
            throughputChart.setOption(throughputOption);

            // 响应窗口大小变化
            window.addEventListener('resize', () => {
                responseTimeChart.resize();
                throughputChart.resize();
            });
        }

        // 初始化系统日志
        function initSystemLogs() {
            const logsContainer = document.getElementById('system-logs');
            
            // 清空容器
            logsContainer.innerHTML = '';
            
            // 查找系统启动完成的日志，提取初始化时间
            const systemInitLog = systemLogs.find(log => log.message.includes('系统启动完成'));
            if (systemInitLog) {
                // 创建系统初始化时间显示div
                const initTimeDiv = document.createElement('div');
                initTimeDiv.className = 'system-init-time';
                initTimeDiv.innerHTML = `
                    <div class="label">系统初始化完成时间</div>
                    <div class="time">${systemInitLog.timestamp}</div>
                `;
                logsContainer.appendChild(initTimeDiv);
            }
            
            // 添加普通日志条目，跳过系统启动完成的日志（避免重复显示）
            systemLogs.forEach(log => {
                // 跳过系统启动完成的日志，因为已经在顶部显示了
                if (log.message.includes('系统启动完成')) {
                    return;
                }
                
                const logDiv = document.createElement('div');
                logDiv.className = `log-entry log-${log.level}`;
                
                const levelColor = {
                    'info': 'text-blue-400',
                    'warning': 'text-yellow-400',
                    'error': 'text-red-400',
                    'success': 'text-green-400'
                }[log.level];

                logDiv.innerHTML = `
                    <div class="flex items-start space-x-2">
                        <div class="w-2 h-2 rounded-full mt-2 ${levelColor.replace('text-', 'bg-')}"></div>
                        <div class="flex-1 min-w-0">
                            <p class="text-xs ${levelColor} mb-1">${log.timestamp}</p>
                            <p class="text-sm text-slate-300">${log.message}</p>
                        </div>
                    </div>
                `;
                
                logsContainer.appendChild(logDiv);
            });
        }

        // 保存配置
        async function saveConfig() {
            try {
                // 检查令牌是否存在
                const token = localStorage.getItem('access_token');
                if (!token) {
                    throw new Error('未登录或登录已过期，请重新登录');
                }
                
                // 获取输入值 - 使用更可靠的选择器
                const configInputs = document.querySelectorAll('.dashboard-card input[type="number"]');
                if (configInputs.length !== 3) {
                    throw new Error('无法找到配置输入字段');
                }
                
                const maxConcurrent = configInputs[0].value;
                const timeoutSeconds = configInputs[1].value;
                const cacheSizeMb = configInputs[2].value;
                
                // 创建配置数据对象
                const configData = {
                    max_concurrent: parseInt(maxConcurrent),
                    timeout_seconds: parseInt(timeoutSeconds),
                    cache_size_mb: parseInt(cacheSizeMb)
                };
                
                // 显示加载状态
                const saveButton = document.querySelector('button[onclick="saveConfig()"]');
                const originalText = saveButton.textContent;
                saveButton.textContent = '保存中...';
                saveButton.disabled = true;
                
                // 发送API请求
                const response = await fetch('http://localhost:8000/api/config', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(configData)
                });
                
                // 获取响应数据
                const responseData = await response.json();
                
                if (!response.ok) {
                    throw new Error(responseData.detail || '保存配置失败');
                }
                
                // 显示成功通知
                const notification = document.createElement('div');
                notification.className = 'fixed top-20 right-6 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50';
                notification.textContent = '配置保存成功！';
                document.body.appendChild(notification);

                // 添加动画
                anime({
                    targets: notification,
                    translateX: [300, 0],
                    opacity: [0, 1],
                    duration: 300,
                    easing: 'easeOutQuart'
                });

                // 3秒后移除通知
                setTimeout(() => {
                    anime({
                        targets: notification,
                        translateX: [0, 300],
                        opacity: [1, 0],
                        duration: 300,
                        easing: 'easeInQuart',
                        complete: () => {
                            document.body.removeChild(notification);
                        }
                    });
                }, 3000);
            } catch (error) {
                // 显示错误通知
                const notification = document.createElement('div');
                notification.className = 'fixed top-20 right-6 bg-red-600 text-white px-6 py-3 rounded-lg shadow-lg z-50';
                notification.textContent = `配置保存失败: ${error.message}`;
                document.body.appendChild(notification);

                // 添加动画
                anime({
                    targets: notification,
                    translateX: [300, 0],
                    opacity: [0, 1],
                    duration: 300,
                    easing: 'easeOutQuart'
                });

                // 3秒后移除通知
                setTimeout(() => {
                    anime({
                        targets: notification,
                        translateX: [0, 300],
                        opacity: [1, 0],
                        duration: 300,
                        easing: 'easeInQuart',
                        complete: () => {
                            document.body.removeChild(notification);
                        }
                    });
                }, 3000);
            } finally {
                // 恢复按钮状态
                const saveButton = document.querySelector('button[onclick="saveConfig()"]');
                saveButton.textContent = '保存配置';
                saveButton.disabled = false;
            }
        }

        // 刷新日志
        function refreshLogs() {
            const logsContainer = document.getElementById('system-logs');
            logsContainer.innerHTML = '';
            
            // 添加新日志条目
            const newLog = {
                timestamp: getCurrentTime(),
                level: 'info',
                message: '系统日志刷新完成'
            };
            
            systemLogs.unshift(newLog);
            if (systemLogs.length > 10) {
                systemLogs.pop();
            }
            
            initSystemLogs();
        }



        // 开始实时更新
        function startRealTimeUpdates() {
            // 每5秒更新一次智能体状态
            setInterval(updateAgentStatuses, 5000);
            
            // 每5秒更新一次系统资源
            setInterval(updateSystemResources, 5000);
            
            // 每30秒添加新日志
            setInterval(addRandomLog, 30000);
        }
        
        // 更新系统资源
        async function updateSystemResources() {
            try {
                // 发送API请求获取系统资源数据
                const response = await fetch('http://localhost:8000/api/system/resources');
                
                if (!response.ok) {
                    throw new Error('获取系统资源失败');
                }
                
                const data = await response.json();
                
                // 更新CPU使用率
                const cpuPercentElement = document.getElementById('cpu-percent');
                const cpuBarElement = document.getElementById('cpu-bar');
                if (cpuPercentElement && cpuBarElement) {
                    cpuPercentElement.textContent = `${data.cpu_percent}%`;
                    cpuBarElement.style.width = `${data.cpu_percent}%`;
                }
                
                // 更新内存使用率
                const memoryPercentElement = document.getElementById('memory-percent');
                const memoryBarElement = document.getElementById('memory-bar');
                if (memoryPercentElement && memoryBarElement) {
                    memoryPercentElement.textContent = `${data.memory_percent}%`;
                    memoryBarElement.style.width = `${data.memory_percent}%`;
                }
                
                // 更新磁盘使用率
                const diskPercentElement = document.getElementById('disk-percent');
                const diskBarElement = document.getElementById('disk-bar');
                if (diskPercentElement && diskBarElement) {
                    diskPercentElement.textContent = `${data.disk_percent}%`;
                    diskBarElement.style.width = `${data.disk_percent}%`;
                }
                
                console.log('系统资源更新成功:', data);
            } catch (error) {
                console.error('更新系统资源失败:', error);
            }
        }

        // 更新智能体状态
        function updateAgentStatuses() {
            // 模拟状态变化
            const progressBars = document.querySelectorAll('.bg-gradient-to-r');
            progressBars.forEach(bar => {
                const currentWidth = parseInt(bar.style.width);
                const newWidth = Math.min(100, currentWidth + Math.floor(Math.random() * 5) - 2);
                bar.style.width = newWidth + '%';
            });
        }

        // 添加随机日志
        function addRandomLog() {
            const logMessages = [
                { level: 'info', message: '智能体状态检查完成' },
                { level: 'success', message: '知识图谱更新成功' },
                { level: 'warning', message: '内存使用率较高' },
                { level: 'info', message: '用户查询处理完成' }
            ];
            
            const randomLog = logMessages[Math.floor(Math.random() * logMessages.length)];
            const newLog = {
                timestamp: getCurrentTime(),
                level: randomLog.level,
                message: randomLog.message
            };
            
            systemLogs.unshift(newLog);
            if (systemLogs.length > 10) {
                systemLogs.pop();
            }
            
            document.getElementById('system-logs').innerHTML = '';
            initSystemLogs();
        }

        // 退出登录功能
        function logout() {
            // 清除localStorage中的token
            localStorage.removeItem('access_token');
            localStorage.removeItem('refresh_token');
            // 重定向到登录页面
            window.location.href = '/login';
        }

        // 初始化动画
        function initAnimations() {
            // 页面加载动画
            anime({
                targets: '.metric-card',
                translateY: [30, 0],
                opacity: [0, 1],
                delay: anime.stagger(100),
                duration: 600,
                easing: 'easeOutQuart'
            });

            anime({
                targets: '.dashboard-card',
                translateY: [50, 0],
                opacity: [0, 1],
                delay: anime.stagger(150, {start: 300}),
                duration: 800,
                easing: 'easeOutQuart'
            });
        }
    </script>
    
    <!-- 引入粒子背景特效 -->
    <script src="main.js"></script>
</body>
</html>