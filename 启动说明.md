# 多智能体知识图谱系统启动说明

本文档提供了多智能体知识图谱系统的完整启动步骤，包括环境要求、依赖安装、配置设置和启动命令。

## 系统环境要求

### 基本要求
- **操作系统**：Windows 10/11、macOS、Linux
- **Docker**：推荐使用Docker Compose方式启动（最简单）
- **Node.js**：v18.x（如选择手动启动前端）
- **Python**：3.10+（如选择手动启动后端）

## 启动方式

### 方式一：Docker Compose启动（推荐）

这种方式最简单，只需确保已安装Docker和Docker Compose。

#### 步骤1：安装Docker和Docker Compose

- **Windows**：下载并安装 [Docker Desktop](https://www.docker.com/products/docker-desktop)
- **macOS**：下载并安装 [Docker Desktop](https://www.docker.com/products/docker-desktop)
- **Linux**：
  - 安装 [Docker Engine](https://docs.docker.com/engine/install/)
  - 安装 [Docker Compose](https://docs.docker.com/compose/install/)

#### 步骤2：配置环境变量（可选）

在项目根目录下找到 `docker-compose.yml` 文件，可根据需要修改环境变量：

```yaml
# 关键配置示例
environment:
  - ENVIRONMENT=production       # 环境设置
  - DEBUG=False                  # 调试模式
  - SECRET_KEY=your-secret-key   # 更换为安全的密钥
  - DB_URL=sqlite:///./app.db    # 数据库连接URL
```

#### 步骤3：构建并启动服务

1. 打开命令行工具（Windows PowerShell、macOS Terminal或Linux终端）
2. 进入项目根目录：
   ```bash
   cd c:/dailywork/graduation project/graduation project - kimi
   ```
3. 执行启动命令：
   ```bash
   docker-compose up -d --build
   ```

这个命令会：
- 构建后端、前端和Redis服务的Docker镜像
- 创建并启动所有容器
- 在后台运行服务

#### 步骤4：验证服务是否正常启动

等待几分钟让服务完全启动，然后：

- 访问前端界面：http://localhost:80
- 访问后端API文档：http://localhost:8000/docs
- 检查服务状态：
  ```bash
  docker ps
  ```

### 方式二：手动启动（开发环境）

如果需要在开发环境中手动启动各组件：

#### 后端启动步骤

1. **安装Python依赖**：
   ```bash
   cd backend
   pip install -r requirements.txt
   ```

2. **配置环境变量**：
   - 复制 `.env.example` 文件为 `.env`
   - 根据需要修改 `.env` 文件中的配置项

3. **启动后端服务**：
   ```bash
   uvicorn src.main:app --host 0.0.0.0 --port 8000 --reload
   ```

后端启动方法:
cd backend ; uvicorn src.main:app --host 0.0.0.0 --port 8000 --reload

#### 前端启动步骤

1. **安装Node.js依赖**：
   ```bash
   cd frontend
   npm install
   ```

2. **启动前端开发服务器**：
   ```bash
   npm run dev
   ```

前端启动方法:
cd frontend ; npm run dev  

3. **访问前端**：
   - 默认地址：http://localhost:3000
   - 注意：需要确保后端服务已经启动

#### Redis启动（可选）

如果需要Redis支持（用于缓存和消息队列）：

```bash
docker run -d --name redis -p 6379:6379 redis:alpine
```

## 常见问题与解决方案

### Docker Compose启动问题

1. **端口被占用**
   - 错误信息：`port is already allocated`
   - 解决方法：修改 `docker-compose.yml` 中的端口映射，或关闭占用端口的程序

2. **构建失败**
   - 错误信息：`failed to build`
   - 解决方法：检查Dockerfile和依赖配置，重新执行 `docker-compose up -d --build`

3. **容器启动后立即退出**
   - 检查容器日志：`docker logs <容器名>`
   - 根据错误信息修复配置问题

### 手动启动问题

1. **Python依赖安装失败**
   - 确保使用Python 3.10+
   - 可以尝试使用虚拟环境：
     ```bash
     python -m venv venv
     .\venv\Scripts\activate  # Windows
     source venv/bin/activate  # macOS/Linux
     pip install -r requirements.txt
     ```

2. **Node.js依赖安装失败**
   - 确保使用Node.js v18.x
   - 清除缓存后重试：
     ```bash
     npm cache clean --force
     npm install
     ```

3. **前后端连接问题**
   - 确保后端服务已启动且端口正确
   - 检查前端API配置是否指向正确的后端地址

## 关闭服务

### Docker Compose方式

```bash
docker-compose down
```

这将停止并移除所有相关容器。

### 手动启动方式

- **后端**：按 `Ctrl+C` 停止uvicorn进程
- **前端**：按 `Ctrl+C` 停止npm进程
- **Redis**：
  ```bash
  docker stop redis
  ```

## 数据持久化

- **数据库**：使用Docker Compose时，数据存储在 `backend-data` 卷中
- **日志**：日志存储在 `backend-logs` 卷中
- **手动启动**：数据存储在后端应用目录下的SQLite文件中

## 开发模式建议

如果需要进行开发：

1. **后端开发**：使用 `--reload` 参数启动uvicorn，支持热重载
2. **前端开发**：使用 `npm run dev` 启动开发服务器，支持热更新
3. **调试API**：访问 http://localhost:8000/docs 查看交互式API文档

## 联系方式

如有启动问题，请联系系统管理员获取支持。